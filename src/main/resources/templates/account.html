<body>
<h2>Добро пожаловать, <span th:text="${user.login}"></span>!</h2>

<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
  <strong>Ошибка!</strong> <span th:text="${error}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div th:if="${account == null}" class="no-account">
  <p>У вас пока нет открытого счёта.</p>
</div>

<div th:if="${account != null}" class="account-info">
  <h3>Ваш счёт:</h3>
  <p><span class="label">Номер счёта:</span> <span th:text="${account.accountNumber}"></span></p>
  <p><span class="label">Тип:</span> <span th:text="${account.accountType.displayName}"></span></p>
  <p><span class="label">Баланс:</span> <span th:text="${#numbers.formatCurrency(account.balance)}"></span></p>
</div>

<div th:if="${account != null and #lists.size(transactions) > 0}" class="transactions-info" style="margin-top: 20px; float: right; width: 40%; border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
  <h3>Последние транзакции:</h3>
  <table style="width: 60%; border-collapse: collapse; margin: 0 auto;">
    <thead>
    <tr style="background-color: #f2f2f2;">
      <th style="text-align: left; padding: 8px;">Тип</th>
      <th style="text-align: left; padding: 8px;">Сумма</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="transaction : ${transactions}"
        class="transaction-row"
        style="border-bottom: 1px solid #ddd; cursor: pointer;"
        th:attr="data-date=${#temporals.format(transaction.date, 'dd.MM.yyyy HH:mm')},
                         data-description=${transaction.description}">
      <td style="padding: 8px;" th:text="${transaction.transactionType.displayName}"></td>
      <td style="padding: 8px;" th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
    </tr>
    </tbody>
  </table>
</div>

<div id="transaction-tooltip" style="
    display: none;
    position: fixed;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    padding: 12px;
    max-width: 280px;
    z-index: 1000;
    font-size: 14px;
    color: #333;
  ">
  <p style="margin: 0 0 4px 0; font-weight: bold;">Дата:</p>
  <p id="tooltip-date" style="margin: 0 0 8px 0;"></p>
  <p style="margin: 0 0 4px 0; font-weight: bold;">Описание:</p>
  <p id="tooltip-description" style="margin: 0;"></p>
</div>


<div class="actions" style="margin-top: 20px; display: flex; flex-direction: column; align-items: flex-start; gap: 10px;">
  <form th:action="@{/deposit}" method="post" style="display: flex; align-items: center; gap: 5px;">
    <label style="display: flex; align-items: center; margin-right: 5px;">
      Сумма пополнения:
      <input type="number" name="amount" step="0.01" min="0.01" required
             style="margin-left: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 120px;"
             placeholder="0.01 и более">
    </label>
    <button type="submit" style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Пополнить счёт
    </button>
  </form>

  <form th:action="@{/withdraw}" method="post" style="display: flex; align-items: center; gap: 5px;">
    <label style="display: flex; align-items: center; margin-right: 5px;">
      Сумма снятия:
      <input type="number" name="amount" step="0.01" min="0.01" required
             style="margin-left: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 120px;"
             placeholder="0.01 и более">
    </label>
    <button type="submit" style="padding: 8px 16px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Снять средства
    </button>
  </form>

  <form th:action="@{/transfer}" method="post" style="display: flex; align-items: center; gap: 5px;">
    <label style="display: flex; align-items: center; margin-right: 5px;">
      Логин получателя:
      <input type="text" name="recipientLogin" required
             style="margin-left: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 180px;"
             placeholder="Введите логин">
    </label>
    <label style="display: flex; align-items: center; margin-right: 5px;">
      Сумма перевода:
      <input type="number" name="amount" step="0.01" min="0.01" required
             style="margin-left: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 120px;"
             placeholder="0.01 и более">
    </label>
    <button type="submit" style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Перевести средства
    </button>
  </form>

  <a th:href="@{/change-password}" style="padding: 8px 16px; background-color: #ffc107; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">
    Сменить пароль
  </a>

  <a th:href="@{/rates}"
     style="padding: 8px 16px; background-color: #17a2b8; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">
    Курсы валют
  </a>

  <form th:action="@{/logout}" method="post" style="display: inline;">
    <button type="submit"
            style="padding: 8px 16px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; border: none; cursor: pointer;">
      Выйти
    </button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.transaction-row');
    const tooltip = document.getElementById('transaction-tooltip');
    const dateSpan = document.getElementById('tooltip-date');
    const descSpan = document.getElementById('tooltip-description');

    function hideTooltip() {
      tooltip.style.display = 'none';
    }

    rows.forEach(row => {
      row.addEventListener('click', function() {

        const date = this.getAttribute('data-date');
        const description = this.getAttribute('data-description');

        dateSpan.textContent = date;
        descSpan.textContent = description;

        const rect = this.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        tooltip.style.top = `${rect.top + scrollTop - 8}px`;
        tooltip.style.left = `${rect.left - 290}px`;

        tooltip.style.display = 'block';

        document.addEventListener('click', function(event) {
          if (!tooltip.contains(event.target) && !row.contains(event.target)) {
            hideTooltip();
          }
        }, { once: true });
      });
    });

    tooltip.addEventListener('click', hideTooltip);

  });
</script>

</body>
